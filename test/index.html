<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
</head>
<body>
<div>
  <form action="" method="post" id="form">
    <textarea name="" id="" cols="30" rows="3"></textarea>
    <input type="submit"/>
  </form>
  <ul id="list">

  </ul>
  <script src="../build/no-framework.js"></script>
  <script>
    var form = document.querySelector('#form');
    var list = document.querySelector('#list');

    form.addEventListener('submit', function (event) {
      event.preventDefault();
      event.stopPropagation();
      var s = Snippet({text: event.currentTarget[0].value});
      snippetFeedCollection.add(s);
      event.currentTarget[0].value = '';
    }, false);

    var nf = require('nf');

    var repo = nf.createRepository({
      localStorage: nf.stores.localStorage()
    });

    var Snippet = nf.Model('Snippet', 'localStorage', repo);

    var snippetFeedCollection = nf.Collection({
      init: function (resolve, reject) {
        var models = repo.findAll('Snippet');
        models.forEach(function (model) {
          this.add(model);
        }, this);
        resolve();
      },
      insert: function (models, model) {
        models.unshift(model);
      }
    });

    snippetFeedCollection.on('add', function (snippetModel) {
      repo.save('Snippet', snippetModel);
    });

    var snippetFeedView = nf.CollectionView({
      template: '<li>{{text}}</li>',
      collection: snippetFeedCollection,
      container: list
    });

  </script>
</div>
</body>
</html>